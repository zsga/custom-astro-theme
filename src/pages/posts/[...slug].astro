---
import { getCollection } from 'astro:content'
import PostLayout from '@/layouts/PostLayout.astro'
import type { GetStaticPaths } from 'astro'
import '@shikijs/twoslash/style-rich.css'
import PreWrapper from '@/components/PreWrapper.astro'
import { formatDate } from '@/utils/date'

export const prerender = true
export const getStaticPaths = (async () => {
  const blogEntries = await getCollection('posts')
  return blogEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }))
}) satisfies GetStaticPaths

const { entry } = Astro.props
const { Content, remarkPluginFrontmatter } = await entry.render()
---

<PostLayout post={entry}>
  <h1>{ entry.data.title }</h1>
  <div class="flex flex-row items-center dark:text-zinc-500 text-sm mb-8 font-grotesk">
    <>
      <div class="i-ri:calendar-line mr-1"></div>
      { formatDate(entry.data.createdAt, false) }
    </>

    <>
      <div class="i-tabler:clock mr-1 ml-4"></div>
      { remarkPluginFrontmatter.minutesRead }
    </>

    <>
      <div class="i-tabler:category mr-1 ml-4"></div>
      { entry.data.category }
    </>

    <>
      <div class="i-tabler:click mr-1 ml-4"></div>
    </>
  </div>

  <div class="flex flex-row items-center flex-wrap m-auto mt-2 mb-6 text-sm gap-2 sm:gap-3">
      { entry.data.tags?.map((item) => (
        <a data-astro-prefetch href={`/tags/${item}`} title="tag details">
          <span class="mr-1 text-pretty tag bg-gradient-to-lightblue"># {item}</span>
        </a>
      ))}
  </div>

  <Content components={{pre: PreWrapper}} />
</PostLayout>

<style>
  .tag {
    color: rgb(20, 184, 166, 1);
    background-color: rgb(20, 184, 166, 0.2);
    border-radius: 3px;
    padding: 2px 5px;
  }
</style>